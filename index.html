<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Noun & Article Master - Option 12</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Noto+Serif:wght@700&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- Phosphor Icons -->
    <script src="https://unpkg.com/@phosphor-icons/web"></script>

    <style>
        body { font-family: 'Noto Sans JP', sans-serif; }
        .font-dancing { font-family: 'Dancing Script', cursive; }
        .font-serif-custom { font-family: 'Noto Serif', serif; }
        
        /* è‹±æ–‡ç”¨ãƒ•ã‚©ãƒ³ãƒˆï¼ˆTimes New Romanï¼‰ã®æŒ‡å®š */
        .font-times { font-family: 'Times New Roman', Times, serif; }

        .animate-in { animation: fadeIn 0.4s ease-out forwards; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆç”¨ã®éè¡¨ç¤ºã‚¯ãƒ©ã‚¹ */
        .hidden-tab { display: none !important; }
        .active-tab { display: block !important; }
        .hidden-content { display: none; }
    </style>
</head>
<body class="bg-gray-100 selection:bg-blue-200 text-gray-900 min-h-screen">
    
    <div class="p-4 md:p-8 max-w-3xl mx-auto">
        <!-- Header -->
        <header class="mb-10 p-6 md:p-8 rounded-2xl shadow-lg relative overflow-hidden" style="background: linear-gradient(135deg, #2b5c9c 0%, #1e4578 100%);">
            <div class="absolute bottom-0 left-0 w-full h-1/2 opacity-20 pointer-events-none" style="background: radial-gradient(ellipse at center bottom, rgba(255,255,255,0.8) 0%, transparent 70%);"></div>
            <div class="absolute -bottom-10 -right-10 w-64 h-64 border-[40px] border-blue-400 rounded-full opacity-10 pointer-events-none"></div>

            <div class="flex flex-col md:flex-row items-center justify-center md:justify-between relative z-10">
                <div class="text-center md:text-left mb-6 md:mb-0">
                    <h1 class="text-6xl md:text-[5rem] font-bold text-white leading-none drop-shadow-md font-dancing" style="text-shadow: 2px 2px 4px rgba(0,0,0,0.2);">
                        <span class="block mb-[-0.2em] relative left-[-10px]">Vision</span>
                        <span class="block ml-6 md:ml-12">Quest</span>
                    </h1>
                </div>

                <div class="flex flex-col items-center md:items-start text-white">
                    <div class="text-sm md:text-base font-sans font-bold tracking-[0.2em] opacity-90 mb-1 drop-shadow-sm">
                        è«–ç†ãƒ»è¡¨ç¾ â… 
                    </div>
                    <div class="text-xl md:text-2xl font-sans font-medium tracking-widest opacity-90 drop-shadow-sm">
                        Advanced
                    </div>
                    <div class="text-[2rem] md:text-[2.5rem] mt-3 tracking-[0.1em] font-serif-custom uppercase drop-shadow-md"
                         style="color: transparent; -webkit-text-stroke: 1px white; text-shadow: 0px 0px 8px rgba(255,255,255,0.4);">
                        Workbook
                    </div>
                </div>
            </div>
            
            <div class="text-center relative z-10 mt-6 md:mt-2">
                <span class="inline-block bg-white text-[#1e4578] px-5 py-2 rounded-full font-black text-sm tracking-widest shadow-md border border-blue-100">
                    Option 12 åè©ãƒ»å† è©
                </span>
            </div>
        </header>

        <!-- Tabs Navigation -->
        <div class="flex flex-col md:flex-row justify-center gap-2 mb-8 bg-white p-1.5 rounded-xl shadow-sm border border-gray-200 w-full md:w-fit mx-auto relative z-20">
            <button id="tab-btn-examples" onclick="switchTab('examples')" class="flex items-center justify-center px-6 py-3 rounded-lg font-bold text-sm transition-all bg-[#1e4578] text-white shadow-md">
                <i class="ph ph-book-open text-lg mr-2"></i> åè©ãƒ»å† è©ã®ãƒ«ãƒ¼ãƒ«ã‚’å­¦ã¶
            </button>
            <button id="tab-btn-exercises" onclick="switchTab('exercises')" class="flex items-center justify-center px-6 py-3 rounded-lg font-bold text-sm transition-all text-gray-500 hover:text-[#1e4578] hover:bg-[#f0f4f9]">
                <i class="ph ph-pen-nib text-lg mr-2"></i> Exercises
            </button>
        </div>

        <!-- Main Content Area -->
        <main id="main-content">
            
            <!-- Examples View (Tab 1) -->
            <div id="view-examples" class="active-tab animate-in">
                <div class="bg-[#eef2f7] border-l-4 border-[#2b5c9c] p-4 rounded-r-lg shadow-sm mb-6">
                    <p class="text-[#1e4578] text-sm font-bold tracking-wide">
                        Option 12 ã§å­¦ã¶åè©ãƒ»å† è©ã®ãƒ«ãƒ¼ãƒ«ã¨ä¾‹æ–‡ã§ã™ã€‚ã‚¹ãƒ”ãƒ¼ã‚«ãƒ¼ãƒœã‚¿ãƒ³ã§ãŠæ‰‹æœ¬ã‚’èãã€ãƒã‚¤ã‚¯ãƒœã‚¿ãƒ³ã§ç™ºéŸ³ã‚’æ¡ç‚¹ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚
                    </p>
                </div>
                <div id="examples-container"></div>
            </div>

            <!-- Exercises View (Tab 2) -->
            <div id="view-exercises" class="hidden-tab animate-in">
                <div class="bg-[#fff4eb] border-l-4 border-[#d97706] p-4 rounded-r-lg mb-6 shadow-sm">
                    <p class="text-[#b45309] text-sm font-bold tracking-wide">
                        å…¥åŠ›æ¬„ã«ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã—ã¦è§£ç­”ã‚’å…¥åŠ›ã—ã€ã€Œç­”ãˆåˆã‚ã›ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦æ­£è§£ã¨è§£èª¬ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚
                    </p>
                </div>
                <div id="exercises-container" class="space-y-6"></div>
            </div>

        </main>

        <!-- Footer -->
        <footer class="mt-16 text-center text-sm text-gray-400 pb-8 font-medium">
            <p>â€»éŸ³å£°èªè­˜æ©Ÿèƒ½ã¯ãƒã‚¤ã‚¯ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯ãŒå¿…è¦ã§ã™ï¼ˆChromeç­‰ã®å¯¾å¿œãƒ–ãƒ©ã‚¦ã‚¶æ¨å¥¨ï¼‰</p>
        </footer>
    </div>

    <script>
        // ==========================================
        // Data Configuration (Option 12 Noun & Article)
        // ==========================================
        const examplesData = [
            { id: 1, verb: "æ™®é€šåè©", meaning: "åŒç¨®é¡ã®ã‚‚ã®ã«å…±é€šã™ã‚‹åå‰", example: "There were five cats in the box.", highlight: "cats", category: "åè©ã®åˆ†é¡ã¨ç”¨æ³•" },
            { id: 2, verb: "æ•°ãˆã‚‰ã‚Œã‚‹é›†åˆåè©", meaning: "é›†åˆä½“ã‚’è¡¨ã™åå‰", example: "A lot of families visit the zoo on weekends.", highlight: "families", category: "åè©ã®åˆ†é¡ã¨ç”¨æ³•" },
            { id: 3, verb: "æ•°ãˆã‚‰ã‚Œãªã„é›†åˆåè©", meaning: "å¸¸ã«å˜æ•°æ‰±ã„ã«ãªã‚‹ï¼ˆbaggage, furnitureãªã©ï¼‰", example: "My room had little furniture.", highlight: "furniture", category: "åè©ã®åˆ†é¡ã¨ç”¨æ³•" },
            { id: 4, verb: "ç‰©è³ªåè©", meaning: "ä¸€å®šã®å½¢ã®ãªã„ç‰©è³ªã‚’è¡¨ã™åå‰ï¼ˆæ•°ãˆã‚‰ã‚Œãªã„ï¼‰", example: "This meat is very tender.", highlight: "meat", category: "åè©ã®åˆ†é¡ã¨ç”¨æ³•" },
            { id: 5, verb: "æŠ½è±¡åè©", meaning: "æ€§è³ªãƒ»çŠ¶æ…‹ãƒ»æ€è€ƒãƒ»æ„Ÿæƒ…ãªã©æŠ½è±¡çš„ãªæ¦‚å¿µã‚’è¡¨ã™åå‰ï¼ˆæ•°ãˆã‚‰ã‚Œãªã„ï¼‰", example: "Honesty is the best policy.", highlight: "Honesty", category: "åè©ã®åˆ†é¡ã¨ç”¨æ³•" },
            { id: 6, verb: "æŠ½è±¡åè©ã®æ•°ãˆæ–¹", meaning: "a piece of ãªã©ã‚’ä»˜ã‘ã‚‹", example: "He gave me a piece of advice.", highlight: "a piece of advice", category: "åè©ã®åˆ†é¡ã¨ç”¨æ³•" },
            
            { id: 7, verb: "åˆã‚ã¦å‡ºã¦ãã‚‹åè©", meaning: "è©±ã®ä¸­ã§åˆã‚ã¦å‡ºã¦ãã‚‹åè©ã«ä»˜ã‘ã‚‹", example: "I bought a new watch today.", highlight: "a new watch", category: "a / an (ä¸å®šå† è©) ã¨ the (å®šå† è©)" },
            { id: 8, verb: "ã€Œ1ã¤ã®ã€œã€ã‚’è¡¨ã™ a / an", meaning: "oneã¨åŒã˜æ„å‘³ã§ä½¿ã‚ã‚Œã‚‹", example: "I stayed in Hokkaido for a week.", highlight: "a week", category: "a / an (ä¸å®šå† è©) ã¨ the (å®šå† è©)" },
            { id: 9, verb: "ã€Œã€œã«ã¤ãã€ã‚’è¡¨ã™ a / an", meaning: "ã€Œ(1ã¤ã®)å˜ä½ã”ã¨ã€ã®æ„å‘³", example: "She runs for an hour three days a week.", highlight: "an hour", category: "a / an (ä¸å®šå† è©) ã¨ the (å®šå† è©)" },
            { id: 10, verb: "ã™ã§ã«å‡ºã¦ããŸåè©", meaning: "è©±ã—æ‰‹ãƒ»èãæ‰‹ã®ä¸­ã§1ã¤ã«æ±ºã¾ã‚‹ã€Œãã®ã€œã€", example: "If you pet a dog, the dog will like you.", highlight: "the dog", category: "a / an (ä¸å®šå† è©) ã¨ the (å®šå† è©)" },
            { id: 11, verb: "çŠ¶æ³ã‹ã‚‰ç‰¹å®šã•ã‚Œã‚‹ã‚‚ã®", meaning: "çŠ¶æ³ã‹ã‚‰åè©ãŒæŒ‡ã™ã‚‚ã®ãŒ1ã¤ã«æ±ºã¾ã‚‹å ´åˆ", example: "Open the door, please.", highlight: "the door", category: "a / an (ä¸å®šå† è©) ã¨ the (å®šå† è©)" },
            { id: 12, verb: "1ã¤ã—ã‹å­˜åœ¨ã—ãªã„ã‚‚ã®", meaning: "the sun, the moon, the earthãªã©", example: "The sun is strong today.", highlight: "The sun", category: "a / an (ä¸å®šå† è©) ã¨ the (å®šå† è©)" },
            
            { id: 13, verb: "æ•°ãˆã‚‰ã‚Œãªã„åè©", meaning: "æ•°ãˆã‚‰ã‚Œãªã„åè©ã« a/an ã¯ä»˜ã‹ãªã„", example: "Do you like coffee?", highlight: "coffee", category: "ç„¡å† è©ã«ãªã‚‹å ´åˆ" },
            { id: 14, verb: "ã€Œæ©Ÿèƒ½ã€ã«ç„¦ç‚¹ã‚’å½“ã¦ã‚‹å ´åˆ", meaning: "å…·ä½“çš„ãªå»ºç‰©ã§ã¯ãªãæ©Ÿèƒ½ã‚’è¡¨ã™å ´åˆ", example: "I have to go to school tomorrow.", highlight: "school", category: "ç„¡å† è©ã«ãªã‚‹å ´åˆ" },
            { id: 15, verb: "ã€Œäº¤é€šæ‰‹æ®µã€ã«ç„¦ç‚¹ã‚’å½“ã¦ã‚‹å ´åˆ", meaning: "å…·ä½“çš„ãªä¹—ã‚Šç‰©ã§ã¯ãªãæ‰‹æ®µã‚’è¡¨ã™å ´åˆ", example: "We went there by car.", highlight: "by car", category: "ç„¡å† è©ã«ãªã‚‹å ´åˆ" }
        ];

        const exercisesData = [
            { id: 1, type: "ç©´åŸ‹ã‚", hint: "é­šã‚’10åŒ¹é‡£ã£ã¦ã€æ°´æ§½ã®ä¸­ã«å…¥ã‚ŒãŸã€‚", exercise: "I caught ten (     ) and put them into the fish tank.", answer: "fish", fullExercise: "I caught ten fish and put them into the fish tank.", explanation: "fishã€Œé­šã€ã¯æ•°ãˆã‚‰ã‚Œã‚‹åè©ã ãŒå˜æ•°å½¢ãƒ»è¤‡æ•°å½¢ã¨ã‚‚ã«fishã€‚ãŸã ã—ç¨®é¡ã‚’è¡¨ã™å ´åˆã¯ fishes ã¨ã—ã¦ã‚‚ã‚ˆã„ã€‚ã€Œæ°´æ§½ã€ã¯fish tankã¨ã™ã‚‹ã€‚" },
            { id: 2, type: "ç©´åŸ‹ã‚", hint: "åŠ‡å ´ã«ã¯ãŸãã•ã‚“ã®è´è¡†ãŒã„ãŸã€‚", exercise: "There was a large (     ) in the theater.", answer: "audience", fullExercise: "There was a large audience in the theater.", explanation: "audienceã€Œè´è¡†ã€ã¯å˜æ•°å½¢ã«ã‚‚è¤‡æ•°å½¢ã«ã‚‚ãªã‚‹é›†åˆåè©ã€‚ã“ã“ã§ã¯é›†åˆã‚’1ã¤ã®ã¾ã¨ã¾ã£ãŸã‚‚ã®ã¨ã¨ã‚‰ãˆå˜æ•°å½¢ã‚’ä½¿ã†ã€‚audienceã®å¤šã„å°‘ãªã„ã¯ large, small ã§è¡¨ã™ã“ã¨ã«æ³¨æ„ã€‚" },
            { id: 3, type: "ç©´åŸ‹ã‚", hint: "å®¶å…·ãŒã»ã¨ã‚“ã©ãªã‹ã£ãŸã®ã§ã€æ˜¨æ—¥ã€é£Ÿå™¨æ£šã‚’è²·ã£ãŸã€‚", exercise: "My room had (     ) (     ), so I bought a cupboard yesterday.", answer: "little furniture", fullExercise: "My room had little furniture, so I bought a cupboard yesterday.", explanation: "furnitureã€Œå®¶å…·ã€ã¯å¸¸ã«å˜æ•°å½¢ã§å˜æ•°æ‰±ã„ã™ã‚‹é›†åˆåè©ã€‚æ•°ãˆã‚‰ã‚Œãªã„åè©ã¨åŒã˜ãã€å¤šã„å°‘ãªã„ã‚’è¡¨ã™ã«ã¯ much [a lot of], littleã‚’ä½¿ã†ã€‚" },
            { id: 4, type: "ç©´åŸ‹ã‚", hint: "ãã®æ™‚ãŠé‡‘ã®æŒã¡åˆã‚ã›ãŒãªã‹ã£ãŸã®ã§ã€ç‰›ä¹³ã‚’è²·ãˆãªã‹ã£ãŸã€‚", exercise: "I had (     ) (     ) then, so I couldn't buy milk.", answer: "no money", fullExercise: "I had no money then, so I couldn't buy milk.", explanation: "moneyã€ŒãŠé‡‘ã€ã‚„milkã€Œç‰›ä¹³ã€ã¯ç‰©è³ªåè©ã§æ•°ãˆã‚‰ã‚Œãšã€å¸¸ã«å˜æ•°æ‰±ã„ã€‚" },
            { id: 5, type: "ä¸¦ã¹æ›¿ãˆ", hint: "ãã®è¡Œæ–¹ä¸æ˜ã®å­ã«ã¤ã„ã¦ã„ãã¤ã‹æƒ…å ±ãŒè­¦å¯Ÿã«å¯„ã›ã‚‰ã‚ŒãŸã€‚", exercise: "( about / child / information / missing / some / the ) was sent to the police.", answer: "Some information about the missing child", fullExercise: "Some information about the missing child was sent to the police.", explanation: "informationã€Œæƒ…å ±ã€ã¯æŠ½è±¡åè©ã§æ•°ãˆã‚‰ã‚Œãšã€å¸¸ã«å˜æ•°æ‰±ã„ã€‚è¤‡æ•°å½¢ã®sã¯ã¤ã‹ãªã„ã€‚" },
            { id: 6, type: "ç©´åŸ‹ã‚", hint: "ãã®å°é¢¨ã¯å¤šãã®æå®³ã‚’ã‚‚ãŸã‚‰ã—ãŸã€‚", exercise: "The typhoon caused a lot of (     ).", answer: "damage", fullExercise: "The typhoon caused a lot of damage.", explanation: "damageã€Œæå®³ã€ã¯æŠ½è±¡åè©ã§ã€å¸¸ã«å˜æ•°æ‰±ã„ã€‚" },
            { id: 7, type: "ä¸¦ã¹æ›¿ãˆ", hint: "æœé£Ÿã«ãƒ™ãƒ¼ã‚³ãƒ³2åˆ‡ã‚Œã¨ã‚†ã§åµã‚’1ã¤é£Ÿã¹ãŸã€‚", exercise: "I had ( a / bacon / boiled / egg / of / slices / two ) for breakfast.", answer: "two slices of bacon and a boiled egg", fullExercise: "I had two slices of bacon and a boiled egg for breakfast.", explanation: "baconã¯æ•°ãˆã‚‰ã‚Œãªã„ã®ã§ a slice of ã‚’ä»˜ã‘ã¦æ•°ãˆã‚‹ã€‚ã‚†ã§åµ(boiled egg)ã¯æ•°ãˆã‚‰ã‚Œã‚‹ã®ã§ a ã‚’ä»˜ã‘ã‚‹ã€‚æœé£Ÿ(breakfast)ã¯è¡Œç‚ºã‚’è¡¨ã™ãŸã‚ç„¡å† è©ã€‚" },
            { id: 8, type: "è‹±ä½œæ–‡", hint: "å½¼ã¯é­šã‚ˆã‚Šé¶è‚‰ãŒå¥½ãã ã€‚(prefer ã‚’ä½¿ã†)", exercise: "Translate the sentence into English.", answer: "He prefers chicken to fish.", fullExercise: "He prefers chicken to fish.", explanation: "chickenã€Œé¶è‚‰ã€ã‚‚fishã€Œé­šè‚‰ã€ã‚‚æ•°ãˆã‚‰ã‚Œãªã„ç‰©è³ªåè©ãªã®ã§ã€å† è©ã‚’ä»˜ã‘ãªã„ã€‚a chickenã ã¨ã€Œ1ç¾½ã®ãƒ‹ãƒ¯ãƒˆãƒªã€ã€a fishã ã¨ã€Œ1åŒ¹ã®é­šã€ã®æ„å‘³ã«ãªã‚‹ã€‚" },
            { id: 9, type: "ä¸¦ã¹æ›¿ãˆ", hint: "æœˆã¯åœ°çƒã®å‘¨ã‚Šã‚’å›ã‚‹ã€‚", exercise: "( around / earth / goes / moon / the / the ).", answer: "The moon goes around the earth", fullExercise: "The moon goes around the earth.", explanation: "moonã€Œæœˆã€ã‚„earthã€Œåœ°çƒã€ãªã©1ã¤ã—ã‹å­˜åœ¨ã—ãªã„ç‰©ã‚’æŒ‡ã™åè©ã«ã¯ the ã‚’ä»˜ã‘ã‚‹ã€‚" },
            { id: 10, type: "ç©´åŸ‹ã‚", hint: "é«˜é€Ÿé“è·¯ã§ã¯æ™‚é€Ÿ80kmã§é‹è»¢ã§ãã‚‹ã€‚", exercise: "We can drive at 80 kilometers (     ) hour on the expressway.", answer: "an", fullExercise: "We can drive at 80 kilometers an hour on the expressway.", explanation: "an hourã€Œ1æ™‚é–“ã«ã¤ãã€ã®ã‚ˆã†ã«ã€å˜ä½ã”ã¨ã‚’è¡¨ã™å ´åˆ, a [an]ã€Œã€œã«ã¤ãã€ã‚’ä½¿ã†ã€‚hour ã¯æ¯éŸ³ã§å§‹ã¾ã‚‹ã®ã§ an ãŒä»˜ãã€‚" },
            { id: 11, type: "ç©´åŸ‹ã‚", hint: "å¾’æ­©ã‚ˆã‚Šã‚€ã—ã‚è‡ªè»¢è»Šã§è¡ŒããŸã„ã€‚", exercise: "I would rather go (     ) bike than on foot.", answer: "by", fullExercise: "I would rather go by bike than on foot.", explanation: "bikeã€Œè‡ªè»¢è»Šã€ã‚„footã€Œè¶³ã€ã¯æ™®é€šåè©ã ãŒã€by bikeã‚„on footãªã©äº¤é€šæ‰‹æ®µã‚’è¡¨ã™å ´åˆã€å† è©ã¯ä»˜ã‹ãªã„ã€‚" },
            { id: 12, type: "è‹±ä½œæ–‡", hint: "ãã®æ—¥ã¯å®¿é¡ŒãŒãŸãã•ã‚“ã‚ã£ãŸã€‚", exercise: "Translate the sentence into English.", answer: "I had a lot of homework on that day.", fullExercise: "I had a lot of homework on that day.", explanation: "homeworkã€Œå®¿é¡Œã€ã¯æŠ½è±¡åè©ã§ã€å¸¸ã«å˜æ•°æ‰±ã„ã€‚è¤‡æ•°å½¢ã®sã¯ã¤ã‹ãªã„ã€‚" },
            { id: 13, type: "è‹±ä½œæ–‡", hint: "å½¼ã¯1é€±é–“å…¥é™¢ã—ã¦ã„ã‚‹ãŒã€æ˜æ—¥é€€é™¢ã™ã‚‹ã€‚(hospital ã‚’ä½¿ã†)", exercise: "Translate the sentence into English.", answer: "He has been in hospital for a week, and he will leave hospital tomorrow.", fullExercise: "He has been in hospital for a week, and he will leave hospital tomorrow.", explanation: "hospitalã€Œç—…é™¢ã€ã¯æ™®é€šåè©ã ãŒã€be in hospitalã€Œå…¥é™¢ã—ã¦ã„ã‚‹ã€ã®ã‚ˆã†ã«æ©Ÿèƒ½ã«ç„¦ç‚¹ã‚’å½“ã¦ã‚‹å ´åˆã¯å† è©ã‚’çœç•¥ã™ã‚‹ã€‚" }
        ];

        // ==========================================
        // Speech & Audio Utilities
        // ==========================================
        let availableVoices = [];
        window.speechSynthesis.onvoiceschanged = () => {
            availableVoices = window.speechSynthesis.getVoices();
        };

        function getEnglishVoice() {
            if (availableVoices.length === 0) availableVoices = window.speechSynthesis.getVoices();
            const preferred = ['Google US English', 'Google UK English Female', 'Samantha', 'Alex'];
            for (const name of preferred) {
                const voice = availableVoices.find(v => v.name === name);
                if (voice) return voice;
            }
            return availableVoices.find(v => v.lang.startsWith('en-'));
        }

        window.playAudio = function(text) {
            if ('speechSynthesis' in window) {
                window.speechSynthesis.cancel();
                const utterance = new SpeechSynthesisUtterance(text);
                utterance.lang = 'en-US';
                utterance.rate = 0.85;
                const voice = getEnglishVoice();
                if (voice) utterance.voice = voice;
                window.speechSynthesis.speak(utterance);
            } else {
                alert("ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯éŸ³å£°èª­ã¿ä¸Šã’ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚");
            }
        };

        function calculatePronunciationScore(recognized, target) {
            const normRec = recognized.toLowerCase().replace(/[^a-z0-9\s']/g, '').trim();
            const normTgt = target.toLowerCase().replace(/[^a-z0-9\s']/g, '').trim();
            
            if (normRec === normTgt) return 100;
            
            const recWords = normRec.split(/\s+/).filter(w => w);
            const tgtWords = normTgt.split(/\s+/).filter(w => w);
            if (recWords.length === 0 || tgtWords.length === 0) return 0;

            let matchCount = 0;
            tgtWords.forEach(word => {
                if (recWords.includes(word)) matchCount++;
            });
            
            const matchRatio = matchCount / tgtWords.length;
            const lengthPenalty = Math.max(0, (recWords.length - tgtWords.length) * 2);
            
            let score = 0;
            if (matchRatio === 1) score = 95 - lengthPenalty;     
            else if (matchRatio >= 0.8) score = 88 - lengthPenalty; 
            else if (matchRatio >= 0.5) score = 78 - lengthPenalty; 
            else if (matchRatio > 0) score = 65 - lengthPenalty;    
            else score = 30; 
            
            score += (normRec.length % 5);
            if (score > 99) score = 99; 
            if (score < 50 && matchRatio > 0) score = 65;
            if (score < 0) score = 0;
            return score;
        }

        const recognitions = {};

        window.startRecording = function(id, text, resultContainerId) {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SpeechRecognition) {
                alert("ãƒ–ãƒ©ã‚¦ã‚¶ãŒéŸ³å£°èªè­˜éå¯¾å¿œã§ã™(Chromeæ¨å¥¨)ã€‚");
                return;
            }

            const btnText = document.getElementById(`mic-text-${id}`);
            const btn = document.getElementById(`mic-btn-${id}`);
            const resultDiv = document.getElementById(resultContainerId);

            if(recognitions[id]) {
                try { recognitions[id].stop(); } catch(e){}
            }

            const recognition = new SpeechRecognition();
            recognitions[id] = recognition;
            recognition.lang = 'en-US';
            recognition.interimResults = false;
            recognition.maxAlternatives = 1;

            recognition.onstart = () => {
                btnText.innerText = "éŒ²éŸ³ä¸­...";
                btn.classList.remove('bg-emerald-500', 'hover:bg-emerald-600');
                btn.classList.add('bg-red-500', 'animate-pulse');
                resultDiv.innerHTML = '';
            };

            recognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                const score = calculatePronunciationScore(transcript, text);
                
                let feedbackHtml = '';
                if (score === 100) feedbackHtml = '<span class="text-yellow-500">Perfect! ğŸ‰</span>';
                else if (score >= 80) feedbackHtml = '<span class="text-emerald-500">Excellent! ğŸ‘</span>';
                else if (score >= 60) feedbackHtml = '<span class="text-blue-500">Good Try! ğŸ™‚</span>';
                else feedbackHtml = '<span class="text-orange-500">Keep Practicing! ğŸ’ª</span>';

                let scoreColor = score >= 80 ? 'text-emerald-600' : (score >= 60 ? 'text-blue-600' : 'text-orange-500');
                let medalColor = score >= 80 ? 'text-yellow-500' : 'text-gray-400';

                resultDiv.innerHTML = `
                    <div class="mt-2 border-t border-gray-200 pt-3 animate-in">
                        <p class="text-sm text-gray-600 mb-2">
                            ã‚ãªãŸã®ç™ºéŸ³: <span class="font-medium font-times text-lg">"${transcript}"</span>
                        </p>
                        <div class="flex items-center bg-white p-2 rounded border border-gray-100 shadow-sm inline-flex flex-wrap gap-2">
                            <div class="flex items-center">
                                <i class="ph-fill ph-medal mr-1 text-xl ${medalColor}"></i>
                                <span class="font-bold text-gray-700 mr-2 text-sm">AI ã‚¹ã‚³ã‚¢:</span>
                                <div class="text-xl font-black ${scoreColor}">${score}</div>
                                <span class="text-gray-500 text-sm ml-1 mt-1">/ 100</span>
                            </div>
                            <span class="ml-2 text-sm font-bold flex items-center">${feedbackHtml}</span>
                        </div>
                    </div>
                `;
            };

            recognition.onerror = (event) => {
                resultDiv.innerHTML = `<p class="text-xs text-red-500 mt-1 animate-in">èªè­˜ã‚¨ãƒ©ãƒ¼: ${event.error}</p>`;
                resetMicButton(id, btn, btnText);
            };

            recognition.onend = () => {
                resetMicButton(id, btn, btnText);
            };

            recognition.start();
        };

        function resetMicButton(id, btn, btnText) {
            btnText.innerText = "ç™ºéŸ³ã™ã‚‹";
            btn.classList.remove('bg-red-500', 'animate-pulse');
            btn.classList.add('bg-emerald-500', 'hover:bg-emerald-600');
            delete recognitions[id];
        }

        // ==========================================
        // UI Generation & Rendering
        // ==========================================
        
        function highlightText(text, highlightStr) {
            if (!highlightStr) return text;
            const regex = new RegExp(`(${highlightStr})`, 'gi');
            return text.replace(regex, '<strong class="text-blue-600 font-bold">$1</strong>');
        }

        function createPronunciationUI(id, textToRead, isWordOnly) {
            const bgClass = isWordOnly ? 'bg-indigo-50/30' : 'bg-gray-50';
            const escapedText = textToRead.replace(/'/g, "\\'");
            return `
                <div class="flex flex-col space-y-3 mt-3 ${bgClass} p-4 rounded-lg">
                    <div class="flex items-center space-x-3">
                        <button onclick="playAudio('${escapedText}')" class="flex items-center space-x-2 px-4 py-2 bg-blue-100 text-blue-700 rounded-full hover:bg-blue-200 transition shadow-sm">
                            <i class="ph ph-speaker-high text-lg"></i>
                            <span class="font-semibold text-sm">ãŠæ‰‹æœ¬ã‚’è´ã</span>
                        </button>
                        <button id="mic-btn-${id}" onclick="startRecording('${id}', '${escapedText}', 'result-${id}')" class="flex items-center space-x-2 px-4 py-2 rounded-full text-white transition shadow-sm bg-emerald-500 hover:bg-emerald-600">
                            <i class="ph ph-microphone text-lg"></i>
                            <span id="mic-text-${id}" class="font-semibold text-sm">ç™ºéŸ³ã™ã‚‹</span>
                        </button>
                    </div>
                    <div id="result-${id}"></div>
                </div>
            `;
        }

        function renderExamples() {
            const container = document.getElementById('examples-container');
            const groupedData = {};
            
            examplesData.forEach(item => {
                if (!groupedData[item.category]) groupedData[item.category] = [];
                groupedData[item.category].push(item);
            });

            let html = '';
            for (const [category, items] of Object.entries(groupedData)) {
                html += `<h2 class="text-xl font-bold text-[#1e4578] border-b-2 border-blue-200 pb-2 mt-8 mb-4">${category}</h2>`;
                html += `<div class="grid grid-cols-1 gap-4">`;
                
                items.forEach(item => {
                    const hasExample = item.example && item.example.trim() !== "";
                    const borderClass = hasExample ? 'mb-4 pb-4 border-b border-gray-100' : 'mb-2';
                    const escapedVerb = item.verb.replace(/'/g, "\\'");
                    
                    let contentHtml = '';
                    if (hasExample) {
                        contentHtml = `
                            <p class="text-2xl md:text-3xl font-medium text-gray-800 mb-2 font-times">${highlightText(item.example, item.highlight)}</p>
                            ${createPronunciationUI(`ex-${item.id}`, item.example, false)}
                        `;
                    } else {
                        contentHtml = createPronunciationUI(`ex-${item.id}`, item.verb, true);
                    }

                    html += `
                        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-5 hover:shadow-md transition">
                            <div class="flex items-start justify-between ${borderClass}">
                                <div>
                                    <div class="flex items-center space-x-3">
                                        <h3 class="text-xl md:text-2xl font-bold text-[#1e4578]">${item.verb}</h3>
                                    </div>
                                    <p class="text-gray-600 mt-1 font-medium text-sm md:text-base">${item.meaning}</p>
                                </div>
                            </div>
                            <div>${contentHtml}</div>
                        </div>
                    `;
                });
                html += `</div>`;
            }
            container.innerHTML = html;
        }

        function renderExercises() {
            const container = document.getElementById('exercises-container');
            let html = '';

            exercisesData.forEach((item, index) => {
                let questionHtml = '';
                if (item.type === "ç©´åŸ‹ã‚") {
                    questionHtml = item.exercise.replace(/(?:\(\s+\)\s*)+/g, `<input type="text" id="input-${item.id}" class="mx-2 border-b-2 border-[#1e4578] bg-blue-50/50 text-center font-bold text-[#1e4578] outline-none focus:bg-blue-100 focus:border-blue-600 px-2 py-1 transition-colors font-times inline-block" style="width: 160px;" autocomplete="off" onkeypress="if(event.key === 'Enter') checkAnswer(${item.id})">`);
                } else {
                    questionHtml = `<span>${item.exercise}</span><div class="mt-3"><input type="text" id="input-${item.id}" class="w-full border-b-2 border-[#1e4578] bg-blue-50/50 font-bold text-[#1e4578] outline-none focus:bg-blue-100 focus:border-blue-600 px-3 py-2 transition-colors font-times" placeholder="è§£ç­”ã‚’ã‚¿ã‚¤ãƒ”ãƒ³ã‚°" autocomplete="off" onkeypress="if(event.key === 'Enter') checkAnswer(${item.id})"></div>`;
                }
                
                html += `
                    <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6 hover:shadow-md transition">
                        <div class="flex items-center justify-between mb-3">
                            <span class="bg-[#1e4578] text-white text-xs font-bold px-3 py-1 rounded-full tracking-wide shadow-sm">
                                ${item.type} (Q${index + 1})
                            </span>
                        </div>
                        
                        <div class="mb-4">
                            <div id="question-text-${item.id}" class="text-xl text-gray-800 font-medium leading-relaxed tracking-wide mb-3 min-h-[3rem] font-times">
                                ${questionHtml}
                            </div>
                            
                            <button onclick="toggleHint(${item.id})" class="text-sm text-gray-500 hover:text-[#1e4578] font-bold flex items-center transition-colors">
                                <i id="hint-icon-${item.id}" class="ph ph-info mr-1 text-lg"></i> 
                                <span id="hint-text-${item.id}">æ—¥æœ¬èªè¨³ï¼ˆãƒ’ãƒ³ãƒˆï¼‰ã‚’è¦‹ã‚‹</span>
                            </button>
                            <div id="hint-panel-${item.id}" class="hidden-content mt-3 bg-gray-50 border-l-4 border-gray-300 p-3 rounded shadow-sm">
                                <p class="text-sm text-gray-600 font-bold">${item.hint}</p>
                            </div>
                        </div>

                        <div class="mt-5 border-t border-gray-100 pt-5">
                            <button id="toggle-btn-${item.id}" onclick="toggleAnswer(${item.id})" class="flex items-center font-bold px-6 py-2.5 rounded-lg transition shadow-sm w-full md:w-auto justify-center bg-[#1e4578] text-white hover:bg-[#14325a]">
                                <i id="toggle-icon-${item.id}" class="ph ph-check-circle text-lg mr-2"></i>
                                <span id="toggle-text-${item.id}">ç­”ãˆåˆã‚ã› / è§£ç­”ã‚’è¦‹ã‚‹</span>
                            </button>

                            <div id="answer-panel-${item.id}" class="hidden-content mt-4 p-5 bg-[#f8fbff] rounded-xl border border-[#c4dbf6]">
                                <div id="judgement-${item.id}" class="mb-4 flex items-center text-xl font-bold font-times tracking-wide"></div>

                                <div class="mb-4">
                                    <span class="text-xs font-bold text-[#1e4578] uppercase tracking-widest mb-1 block">Answer</span>
                                    <p class="text-2xl font-bold text-blue-600 font-times">${item.answer}</p>
                                </div>
                                
                                ${item.explanation ? `
                                <div class="mb-5 bg-white p-4 rounded-lg border border-blue-100 shadow-sm">
                                    <span class="text-xs font-bold text-blue-500 uppercase tracking-widest mb-2 flex items-center">
                                        <i class="ph-fill ph-lightbulb text-base mr-1"></i> è§£èª¬
                                    </span>
                                    <p class="text-sm text-gray-700 leading-relaxed font-medium">${item.explanation}</p>
                                </div>
                                ` : ''}

                                <div class="mb-2 border-t border-[#c4dbf6] pt-4">
                                    <span class="text-xs font-bold text-[#1e4578] uppercase tracking-widest mb-2 block">Voice Practice</span>
                                    ${createPronunciationUI(`ex-prac-${item.id}`, item.fullExercise, false)}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        // ==========================================
        // Interaction Logic
        // ==========================================

        window.toggleHint = function(id) {
            const panel = document.getElementById(`hint-panel-${id}`);
            const text = document.getElementById(`hint-text-${id}`);
            const icon = document.getElementById(`hint-icon-${id}`);
            if (panel.classList.contains('hidden-content')) {
                panel.classList.remove('hidden-content');
                panel.classList.add('animate-in');
                text.innerText = "æ—¥æœ¬èªè¨³ï¼ˆãƒ’ãƒ³ãƒˆï¼‰ã‚’é–‰ã˜ã‚‹";
                icon.classList.replace('ph-info', 'ph-eye-closed');
            } else {
                panel.classList.add('hidden-content');
                panel.classList.remove('animate-in');
                text.innerText = "æ—¥æœ¬èªè¨³ï¼ˆãƒ’ãƒ³ãƒˆï¼‰ã‚’è¦‹ã‚‹";
                icon.classList.replace('ph-eye-closed', 'ph-info');
            }
        };

        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›å€¤ã‚’ä¿æŒã™ã‚‹ãŸã‚ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
        window.userInputs = {};
        window.answerStates = {};

        window.toggleAnswer = function(id) {
            const isShowing = window.answerStates[id] || false;
            const newShowing = !isShowing;
            window.answerStates[id] = newShowing;

            const panel = document.getElementById(`answer-panel-${id}`);
            const btn = document.getElementById(`toggle-btn-${id}`);
            const icon = document.getElementById(`toggle-icon-${id}`);
            const text = document.getElementById(`toggle-text-${id}`);
            const questionText = document.getElementById(`question-text-${id}`);
            const judgeEl = document.getElementById(`judgement-${id}`);
            const item = exercisesData.find(ex => ex.id === id);

            if (newShowing) {
                // å…¥åŠ›å†…å®¹ã®å–å¾—ã¨ä¿å­˜
                const inputEl = document.getElementById(`input-${id}`);
                const userValue = inputEl ? inputEl.value : (window.userInputs[id] || '');
                window.userInputs[id] = userValue;

                const normalize = (str) => str.toLowerCase().replace(/[\s\.\,\?\!]/g, '');
                const isCorrect = normalize(userValue) === normalize(item.answer);

                // åˆ¤å®šçµæœã®è¡¨ç¤º
                if (userValue.trim() === '') {
                    judgeEl.innerHTML = `<i class="ph-fill ph-info text-blue-500 text-3xl mr-2"></i> <span class="text-blue-600">è§£ç­”ã‚’è¡¨ç¤ºã—ã¾ã—ãŸ</span>`;
                } else if (isCorrect) {
                    judgeEl.innerHTML = `<i class="ph-fill ph-check-circle text-emerald-500 text-3xl mr-2"></i> <span class="text-emerald-600">Correct! ğŸ‰</span>`;
                } else {
                    judgeEl.innerHTML = `<i class="ph-fill ph-x-circle text-red-500 text-3xl mr-2"></i> <span class="text-red-500">Incorrect...</span> <span class="text-sm text-gray-500 ml-4 font-sans font-normal">ã‚ãªãŸã®å…¥åŠ›: ${userValue}</span>`;
                }

                // â˜…å•é¡Œæ–‡ã‚’å®Œå…¨ãªè‹±æ–‡ï¼ˆæ­£è§£ãƒã‚¤ãƒ©ã‚¤ãƒˆä»˜ãï¼‰ã«å·®ã—æ›¿ãˆã‚‹
                questionText.innerHTML = highlightText(item.fullExercise, item.answer);

                // ãƒ‘ãƒãƒ«ã®è¡¨ç¤º
                panel.classList.remove('hidden-content');
                panel.classList.add('animate-in');
                
                btn.classList.remove('bg-[#1e4578]', 'text-white', 'hover:bg-[#14325a]');
                btn.classList.add('bg-gray-100', 'text-gray-600', 'hover:bg-gray-200');
                
                icon.classList.replace('ph-check-circle', 'ph-eye-closed');
                text.innerText = "è§£ç­”ãƒ»è§£èª¬ã‚’éš ã™";
            } else {
                // â˜…éš ã™æ™‚ã¯å…¥åŠ›æ¬„ï¼ˆinputï¼‰ã‚’å¾©å…ƒã™ã‚‹
                let questionHtml = '';
                if (item.type === "ç©´åŸ‹ã‚") {
                    questionHtml = item.exercise.replace(/(?:\(\s+\)\s*)+/g, `<input type="text" id="input-${item.id}" class="mx-2 border-b-2 border-[#1e4578] bg-blue-50/50 text-center font-bold text-[#1e4578] outline-none focus:bg-blue-100 focus:border-blue-600 px-2 py-1 transition-colors font-times inline-block" style="width: 160px;" autocomplete="off" onkeypress="if(event.key === 'Enter') checkAnswer(${item.id})">`);
                } else {
                    questionHtml = `<span>${item.exercise}</span><div class="mt-3"><input type="text" id="input-${item.id}" class="w-full border-b-2 border-[#1e4578] bg-blue-50/50 font-bold text-[#1e4578] outline-none focus:bg-blue-100 focus:border-blue-600 px-3 py-2 transition-colors font-times" placeholder="è§£ç­”ã‚’ã‚¿ã‚¤ãƒ”ãƒ³ã‚°" autocomplete="off" onkeypress="if(event.key === 'Enter') checkAnswer(${item.id})"></div>`;
                }
                questionText.innerHTML = questionHtml;

                // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå…¥åŠ›ã—ã¦ã„ãŸæ–‡å­—ã‚’å¾©å…ƒ
                const restoredInput = document.getElementById(`input-${id}`);
                if (restoredInput && window.userInputs[id]) {
                    restoredInput.value = window.userInputs[id];
                }

                // ãƒ‘ãƒãƒ«ã‚’éš ã™
                panel.classList.add('hidden-content');
                panel.classList.remove('animate-in');
                
                btn.classList.add('bg-[#1e4578]', 'text-white', 'hover:bg-[#14325a]');
                btn.classList.remove('bg-gray-100', 'text-gray-600', 'hover:bg-gray-200');
                
                icon.classList.replace('ph-eye-closed', 'ph-check-circle');
                text.innerText = "ç­”ãˆåˆã‚ã› / è§£ç­”ã‚’è¦‹ã‚‹";
            }
        };

        window.checkAnswer = function(id) {
            // ã‚¨ãƒ³ã‚¿ãƒ¼ã‚­ãƒ¼ã‚’æŠ¼ã—ãŸæ™‚ã«ãƒ‘ãƒãƒ«ãŒé–‹ã„ã¦ã„ãªã‘ã‚Œã°é–‹ã
            if (!window.answerStates[id]) {
                toggleAnswer(id);
            }
        };

        // Tab Switching Logic
        window.switchTab = function(tabName) {
            const viewExamples = document.getElementById('view-examples');
            const viewExercises = document.getElementById('view-exercises');
            const btnExamples = document.getElementById('tab-btn-examples');
            const btnExercises = document.getElementById('tab-btn-exercises');

            const activeClasses = ['bg-[#1e4578]', 'text-white', 'shadow-md'];
            const inactiveClasses = ['text-gray-500', 'hover:text-[#1e4578]', 'hover:bg-[#f0f4f9]'];

            if (tabName === 'examples') {
                viewExamples.classList.replace('hidden-tab', 'active-tab');
                viewExercises.classList.replace('active-tab', 'hidden-tab');
                
                btnExamples.classList.add(...activeClasses);
                btnExamples.classList.remove(...inactiveClasses);
                
                btnExercises.classList.remove(...activeClasses);
                btnExercises.classList.add(...inactiveClasses);
            } else {
                viewExercises.classList.replace('hidden-tab', 'active-tab');
                viewExamples.classList.replace('active-tab', 'hidden-tab');
                
                btnExercises.classList.add(...activeClasses);
                btnExercises.classList.remove(...inactiveClasses);
                
                btnExamples.classList.remove(...activeClasses);
                btnExamples.classList.add(...inactiveClasses);
            }
        };

        // Initialize App
        window.onload = () => {
            renderExamples();
            renderExercises();
        };

    </script>
</body>
</html>